<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        .page{
            display: flex;
            justify-content: center;
            align-items: center;

        }
        .page span{
            width: 20px;
            height: 20px;
            cursor: pointer;
            border: 1px solid #000;
            text-align: center;
            line-height: 20px;
            margin: 0 5px;
            border-radius: 5px;
        }
        .page span.act{
            color: #fff;
            background-color: salmon;
            border: none;
        }
    </style>
</head>
<body>
    <label>姓名</label> <input type="text" id="username"><br>
    <label>年龄</label> <input type="text" id="age"><br>
    <label>性别</label> 
        <label> <input type="radio" name="sex" value="男">男</label>
        <label> <input type="radio" name="sex" value="女">女</label><br>
    <label>手机号</label> <input type="text" id="tel" > <br>
    <button id="add">添加</button>
    <button id="up">修改</button>
<hr>

    <table border="1" id="tab">
        <tr>
            <th>序号</th>
            <th>姓名</th>
            <th>年龄</th>
            <th>性别</th>
            <th>手机号</th>
            <th>操作</th>
        </tr>
        <tr>
            <th>1</th>
            <th>张飞</th>
            <th>20</th>
            <th>男</th>
            <th>15112345678</th>
            <th>
                <button>删除</button>
                <button>修改</button>
            </th>
        </tr>
    </table>
    <div class="page">
        <span class="act">1</span>
        <span>2</span>
        <span>3</span>
        <span>4</span>
    </div>
    <button id="test">测试</button>
</body>
</html>
<script src="./js/axios.min.js"></script>
<script>
    let tab = document.querySelector('#tab');
    let ID = 0;
    let p = 1;
    let num = 3;
    function $(ele){
        return document.querySelector(ele);
    }
//设置页码
    function setpage(){
        axios.get('/user/count').then(res=>{
        console.log(res.data);
        let n =res.data.info[0].total;
        console.log(n);
        let page = Math.ceil(n/num);
        console.log(page);
        let html = '';
        $('.page').innerHTML = '';
        for (let i = 1; i <= page; i++) {
            html+=`
                <span onclick="changePage(${i})" class='${p==i&&'act'}'>${i}</span>
            `
        }
        $('.page').innerHTML = html;
    })
    }
    // setpage()
    function changePage(curr){
        p = curr;
        getAll();
        // setpage();
    }
//设置获取全部数据方法
function getAll(){
   
    setpage()
    axios.get(`/user/test?p=${p}&num=${num}`).then(res=>{
        console.log(res.data);
        let arr =res.data.list;
        tab.innerHTML = '';
        let html = `
        <tr>
            <th>序号</th>
            <th>姓名</th>
            <th>年龄</th>
            <th>性别</th>
            <th>手机号</th>
            <th>操作</th>
        </tr>
        `;
        for (let i = 0; i < arr.length; i++) {
            html+=`
            <tr>
                <th>${arr[i].id}</th>
                <th>${arr[i].name}</th>
                <th>${arr[i].age}</th>
                <th>${arr[i].sex}</th>
                <th>${arr[i].tel}</th>
                <th>
                    <button onclick="del(${arr[i].id})">删除</button>
                    <button onclick="update(${arr[i].id})">修改</button>
                </th>
            </tr>
        `
    }
    tab.innerHTML = html;
    })
}
getAll();

//添加数据
$('#add').onclick =()=>{
    let obj = {
        name:$('#username').value,
        age:$('#age').value,
        tel:$('#tel').value,
        sex:$('input[name="sex"]:checked').value
    };
    axios.post('/user/add',obj).then(res=>{
        console.log(res.data);
        if(res.data.code==200){
            getAll();
        }
        $('#username').value='';
        $('#age').value='';
        $('#tel').value='';
    })
}
//修改信息
function update(id){
    ID = id;
    axios.get('/user/update/'+id).then(res=>{
        console.log(res.data);  
        let obj = res.data.data[0] 
        $('#username').value=obj.name;
        $('#age').value=obj.age;
        $('#tel').value=obj.tel;
        $(`input[value="${obj.sex}"]`).checked='true';
    })
}
$('#up').onclick =function(){
   let obj = {
        id:ID,
        name:$('#username').value,
        age:$('#age').value,
        tel:$('#tel').value,
        sex:$(`input[name="sex"]:checked`).value
    };
    axios.post('/user/updates',obj).then(res=>{
        console.log(res.data);
        if(res.data.code==200){
            getAll();   
        }
        $('#username').value='';
        $('#age').value='';
        $('#tel').value='';
  }) 
}
//删除数据
function del(id){
    axios.get('/user/del/'+id).then(res=>{
        console.log(res.data);
        if(res.data.code==200){
            getAll();
        }
})
}
$('#test').onclick = function(){
    axios.get('/user/test?p=1&num=5').then(res=>{
    console.log(res.data);
})
}
</script>